<!DOCTYPE html>
<html>
<head>
    <title>–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .search-form { background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .form-row { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 15px; }
        .form-group { flex: 1; min-width: 200px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ddd; }
        button { padding: 10px 15px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; cursor: pointer; }
        th:hover { background-color: #e6e6e6; }
        .sort-arrow { margin-left: 5px; }
        .user-link { color: #0066cc; text-decoration: none; }
        .user-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="user-panel">
        {% if current_user %}
            <span class="user-greeting">üëã –ü—Ä–∏–≤–µ—Ç, {{ current_user.name }} {{ current_user.surname }}!</span>
            <a href="/logout">üö™ –í—ã–π—Ç–∏</a>
            <a href="/"> –ì–ª–∞–≤–Ω–∞—è</a>
        {% else %}
            <a href="/login">üîë –í–æ–π—Ç–∏</a>
            <a href="/register">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            <a href="/"> –ì–ª–∞–≤–Ω–∞—è</a>
        {% endif %}
    </div>
    <h1>–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>

    <form method="get" class="search-form">
        <div class="form-row">
            <div class="form-group">
                <label for="username">–Æ–∑–µ—Ä–Ω–µ–π–º:</label>
                <input type="text" id="username" name="username" value="{{ filters.username or '' }}">
            </div>

            <div class="form-group">
                <label for="name">–ò–º—è:</label>
                <input type="text" id="name" name="name" value="{{ filters.name or '' }}">
            </div>

            <div class="form-group">
                <label for="surname">–§–∞–º–∏–ª–∏—è:</label>
                <input type="text" id="surname" name="surname" value="{{ filters.surname or '' }}">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="status">–°—Ç–∞—Ç—É—Å:</label>
                <select id="status" name="status">
                    <option value="">–í—Å–µ</option>
                    {% for status in available_statuses %}
                    <option value="{{ status }}" {% if filters.status == status %}selected{% endif %}>{{ status|capitalize }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="date_from">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ—Ç:</label>
                <input type="date" id="date_from" name="date_from" value="{{ filters.date_from or '' }}">
            </div>

            <div class="form-group">
                <label for="date_to">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ:</label>
                <input type="date" id="date_to" name="date_to" value="{{ filters.date_to or '' }}">
            </div>
        </div>

        <input type="hidden" name="sort_by" value="{{ filters.sort_by or 'created_at' }}">
        <input type="hidden" name="sort_order" value="{{ filters.sort_order or 'desc' }}">

        <button type="submit">–ü–æ–∏—Å–∫</button>
    </form>

    <table>
        <thead>
            <tr>
                <th onclick="sortTable('username')">
                    –Æ–∑–µ—Ä–Ω–µ–π–º
                    {% if filters.sort_by == 'username' %}
                    <span class="sort-arrow">{% if filters.sort_order == 'asc' %}‚Üë{% else %}‚Üì{% endif %}</span>
                    {% endif %}
                </th>
                <th onclick="sortTable('name')">
                    –ò–º—è
                    {% if filters.sort_by == 'name' %}
                    <span class="sort-arrow">{% if filters.sort_order == 'asc' %}‚Üë{% else %}‚Üì{% endif %}</span>
                    {% endif %}
                </th>
                <th onclick="sortTable('surname')">
                    –§–∞–º–∏–ª–∏—è
                    {% if filters.sort_by == 'surname' %}
                    <span class="sort-arrow">{% if filters.sort_order == 'asc' %}‚Üë{% else %}‚Üì{% endif %}</span>
                    {% endif %}
                </th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th onclick="sortTable('created_at')">
                    –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                    {% if filters.sort_by == 'created_at' %}
                    <span class="sort-arrow">{% if filters.sort_order == 'asc' %}‚Üë{% else %}‚Üì{% endif %}</span>
                    {% endif %}
                </th>
                <th onclick="sortTable('post_count')">
                    –ö–æ–ª-–≤–æ –ø–æ—Å—Ç–æ–≤
                    {% if filters.sort_by == 'post_count' %}
                    <span class="sort-arrow">{% if filters.sort_order == 'asc' %}‚Üë{% else %}‚Üì{% endif %}</span>
                    {% endif %}
                </th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td><a href="/user/{{ user._id }}" class="user-link">{{ user.username }}</a></td>
                <td>{{ user.name }}</td>
                <td>{{ user.surname }}</td>
                <td>{{ user.status or 'user' }}</td>
                <td>{{ user.formatted_date }}</td>
                <td>{{ user.post_count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function sortTable(field) {
            const url = new URL(window.location.href);
            const params = new URLSearchParams(url.search);

            if (params.get('sort_by') === field) {
                // –ï—Å–ª–∏ —É–∂–µ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —ç—Ç–æ–º—É –ø–æ–ª—é, –º–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                params.set('sort_order', params.get('sort_order') === 'asc' ? 'desc' : 'asc');
            } else {
                // –ï—Å–ª–∏ –Ω–æ–≤–æ–µ –ø–æ–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
                params.set('sort_by', field);
                params.set('sort_order', 'asc');
            }

            window.location.href = url.pathname + '?' + params.toString();
        }
    </script>
</body>
</html>