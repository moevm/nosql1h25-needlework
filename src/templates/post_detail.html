<!DOCTYPE html>
<html>
<head>
    <title>{{ post.scheme_name }} - –î–µ—Ç–∞–ª–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .user-panel {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .user-panel a {
            margin-right: 15px;
            text-decoration: none;
            color: #0066cc;
        }
        .post-header {
            margin-bottom: 20px;
        }
        .post-image {
            max-width: 100%;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .post-meta {
            color: #666;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        .post-actions {
            margin: 15px 0;
        }
        .post-actions button {
            padding: 5px 10px;
            border: 1px solid #ddd;
            background: #f5f5f5;
            cursor: pointer;
            border-radius: 4px;
        }
        .post-actions button.liked {
            background: #4CAF50;
            color: white;
        }
        .post-actions button.disliked {
            background: #f44336;
            color: white;
        }
        .legend {
            background: #f5f5f5;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .legend-item {
            display: inline-block;
            margin: 5px 10px;
        }
        .scheme {
            font-family: monospace;
            white-space: pre;
            background: #f8f8f8;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .comments-section {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .comment {
            border-bottom: 1px solid #eee;
            padding: 15px 0;
        }
        .comment-author {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .comment-date {
            color: #666;
            font-size: 0.8em;
        }
        .comment-text {
            margin-top: 5px;
        }
        .comment-form {
            margin-top: 20px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
        }
        .comment-form textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .comment-form button {
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .color-box {
            display: inline-block;
            width: 15px;
            height: 15px;
            margin-right: 5px;
            border: 1px solid #ccc;
            vertical-align: middle;
        }
        .back-link {
            display: inline-block;
            margin-top: 20px;
            padding: 8px 15px;
            background: #f5f5f5;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="user-panel">
        {% if current_user %}
            <span>üëã –ü—Ä–∏–≤–µ—Ç, {{ current_user.name }}!</span>
            <a href="/logout">üö™ –í—ã–π—Ç–∏</a>
            <a href="/">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/users">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
        {% else %}
            <a href="/login">üîë –í–æ–π—Ç–∏</a>
            <a href="/register">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            <a href="/">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/users">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
        {% endif %}
    </div>

    <div class="post-header">
        <h1>{{ post.scheme_name }}</h1>
        <div class="post-meta">
            –ê–≤—Ç–æ—Ä: <a href="/user/{{ post.author._id }}">{{ post.author.name }} {{ post.author.surname }}</a> |
            –î–∞—Ç–∞: {{ post.formatted_date }} |
            –¢–∏–ø: {{ post.type }}
        </div>

        <div class="post-actions">
            {% if current_user %}
                <form method="post" action="/post/{{ post._id }}/like" style="display: inline;">
                    <button type="submit" {% if post.user_liked %}class="liked"{% endif %}>
                        üëç {{ post.likes|length }}
                    </button>
                </form>
                <form method="post" action="/post/{{ post._id }}/dislike" style="display: inline; margin-left: 10px;">
                    <button type="submit" {% if post.user_disliked %}class="disliked"{% endif %}>
                        üëé {{ post.dislikes|length }}
                    </button>
                </form>
            {% else %}
                <span>üëç {{ post.likes|length }}</span>
                <span style="margin-left: 10px;">üëé {{ post.dislikes|length }}</span>
                <small>(<a href="/login">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏—Ç—å)</small>
            {% endif %}
        </div>
    </div>

    {% if post.preview_image_id %}
    <div>
        <img src="/image/{{ post.preview_image_id }}" class="post-image" alt="{{ post.scheme_name }}">
    </div>
    {% endif %}

    <div class="post-content">
        {% if post.description %}
        <h2>–û–ø–∏—Å–∞–Ω–∏–µ</h2>
        <p>{{ post.description }}</p>
        {% endif %}

        {% if post.comment %}
        <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∞–≤—Ç–æ—Ä–∞</h3>
        <p>{{ post.comment }}</p>
        {% endif %}

        <h2>–õ–µ–≥–µ–Ω–¥–∞</h2>
        <div class="legend">
            {% for code, color_name in post.color_legend %}
            <div class="legend-item">
                {% if color_name in ['–∫—Ä–∞—Å–Ω—ã–π', '–ê–ª—ã–π', 'Red'] %}
                <span class="color-box" style="background-color: #ff0000;"></span>
                {% elif color_name in ['—Å–∏–Ω–∏–π', 'Blue'] %}
                <span class="color-box" style="background-color: #0000ff;"></span>
                {% elif color_name in ['–∑–µ–ª–µ–Ω—ã–π', 'Green'] %}
                <span class="color-box" style="background-color: #00ff00;"></span>
                {% elif color_name in ['—á–µ—Ä–Ω—ã–π', 'Black'] %}
                <span class="color-box" style="background-color: #000000;"></span>
                {% elif color_name in ['–±–µ–ª—ã–π', 'White'] %}
                <span class="color-box" style="background-color: #ffffff;"></span>
                {% else %}
                <span class="color-box" style="background-color: #cccccc;"></span>
                {% endif %}
                {{ code }}: {{ color_name }}
            </div>
            {% endfor %}
        </div>

        <h2>–°—Ö–µ–º–∞</h2>
        <div class="scheme">
            {% for row in post.scheme %}
            {% for code, length in row %}{{ code }}({{ length }}) {% endfor %}
            <br>
            {% endfor %}
        </div>

        <div class="post-stats">
            <p>–¶–≤–µ—Ç–æ–≤: {{ post.color_count }} | –°—Ç–µ–∂–∫–æ–≤: {{ post.length }}</p>
        </div>
    </div>

    <div class="comments-section">
        <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ post.comments|length }})</h2>

        {% if current_user %}
        <div class="comment-form">
            <form method="post" action="/post/{{ post._id }}/comment">
                <textarea name="comment_text" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
                <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
            </form>
        </div>
        {% else %}
        <p><a href="/login">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</p>
        {% endif %}

        {% if post.comments %}
            {% for comment in post.comments %}
            <div class="comment">
                <div class="comment-author">{{ comment.author.name }} {{ comment.author.surname }}</div>
                <div class="comment-date">{{ comment.formatted_date }}</div>
                <div class="comment-text">{{ comment.text }}</div>
            </div>
            {% endfor %}
        {% else %}
            <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
        {% endif %}
    </div>

    <a href="/" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –ø–æ—Å—Ç–æ–≤</a>
</body>
</html>