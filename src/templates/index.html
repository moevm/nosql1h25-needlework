<!DOCTYPE html>
<html>
<head>
    <title>–í—ã—à–∏–≤–∫–∞ - –í—Å–µ –ø–æ—Å—Ç—ã</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }

        .user-panel {
            float: right;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .user-panel a {
            color: #007bff;
            text-decoration: none;
            margin-left: 10px;
        }
        .user-panel a:hover {
            text-decoration: underline;
        }
        .user-greeting {
            font-weight: bold;
            color: #28a745;
        }

        .filters {
            background: #f5f5f5;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            clear: both;
        }
        .filter-group {
            margin-bottom: 15px;
        }
        .filter-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        label {
            min-width: 150px;
            font-weight: bold;
        }
        input, select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        input[type="number"], input[type="date"] {
            width: 120px;
        }
        button {
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: #45a049;
        }
        a.reset {
            color: #f44336;
            text-decoration: none;
            margin-left: 15px;
        }
        .post {
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            background: white;
        }
        .post-title {
            font-size: 1.4em;
            margin-bottom: 10px;
        }
        .post-title a {
            color: #333;
            text-decoration: none;
        }
        .post-title a:hover {
            color: #0066cc;
        }
        .post-meta {
            color: #666;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        .post-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            color: #555;
        }
        .colors-select {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 5px;
            max-height: 200px;
            overflow-y: auto;
            padding: 5px;
        }
        .color-option {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px;
            background: #fff;
            border-radius: 4px;
            border: 1px solid #eee;
        }
        .color-preview {
            width: 20px;
            height: 20px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .post-image {
            max-width: 100%;
            height: auto;
            margin-top: 15px;
            border-radius: 4px;
        }
        .no-posts {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="user-panel">
        {% if current_user %}
            <span class="user-greeting">üëã –ü—Ä–∏–≤–µ—Ç, {{ current_user.name }} {{ current_user.surname }}!</span>
            <a href="/logout">üö™ –í—ã–π—Ç–∏</a>
            <a href="/users">üë§ –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</a>
            <a href="/create-post">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</a>
            <a href="/create-action">–î–æ–±–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ</a>
        {% else %}
            <a href="/login">üîë –í–æ–π—Ç–∏</a>
            <a href="/register">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            <a href="/users">üë§ –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</a>
        {% endif %}
    </div>

    <h1>–í—Å–µ —Å—Ö–µ–º—ã –¥–ª—è —Ä—É–∫–æ–¥–µ–ª–∏—è</h1>

    <div class="filters">
        <form method="get" id="filterForm">
            <div class="filter-group">
                <div class="filter-row">
                    <label for="type">–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</label>
                    <select id="type" name="type">
                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                        {% for t in available_types %}
                        <option value="{{ t }}" {% if filters.type == t %}selected{% endif %}>{{ t }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="filter-group">
                <div class="filter-row">
                    <label>–¶–≤–µ—Ç–∞:</label>
                </div>
                <div class="colors-select">
                    {% for color in available_colors %}
                    <div class="color-option">
                        <input type="checkbox"
                               id="color_{{ color._id }}"
                               name="color_ids"
                               value="{{ color._id }}"
                               {% if filters.color_ids and color._id|string in filters.color_ids.split(',') %}checked{% endif %}>
                        <div class="color-preview" style="background-color: {{ color.name }};"></div>
                        <label for="color_{{ color._id }}">{{ color.name }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="filter-group">
                <div class="filter-row">
                    <label>–î–ª–∏–Ω–∞ –Ω–∏—Ç–æ–∫:</label>
                    <input type="number" name="min_length" placeholder="–û—Ç" value="{{ filters.min_length }}" min="0">
                    <input type="number" name="max_length" placeholder="–î–æ" value="{{ filters.max_length }}" min="0">
                </div>
            </div>

            <div class="filter-group">
                <div class="filter-row">
                    <label>–ö–æ–ª-–≤–æ —Ü–≤–µ—Ç–æ–≤:</label>
                    <input type="number" name="min_colors" placeholder="–û—Ç" value="{{ filters.min_colors }}" min="1">
                    <input type="number" name="max_colors" placeholder="–î–æ" value="{{ filters.max_colors }}" min="1">
                </div>
            </div>

            <div class="filter-group">
                <div class="filter-row">
                    <label>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</label>
                    <input type="date" name="date_from" value="{{ filters.date_from }}">
                    <input type="date" name="date_to" value="{{ filters.date_to }}">
                </div>
            </div>

            <div class="filter-group">
                <div class="filter-row">
                    <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                    <select name="sort_by">
                        <option value="created_at" {% if filters.sort_by == 'created_at' %}selected{% endif %}>–î–∞—Ç–∞</option>
                        <option value="likes" {% if filters.sort_by == 'likes' %}selected{% endif %}>–õ–∞–π–∫–∏</option>
                        <option value="color_count" {% if filters.sort_by == 'color_count' %}selected{% endif %}>–¶–≤–µ—Ç–∞</option>
                        <option value="length" {% if filters.sort_by == 'length' %}selected{% endif %}>–î–ª–∏–Ω–∞</option>
                    </select>
                    <select name="sort_order">
                        <option value="desc" {% if filters.sort_order == 'desc' %}selected{% endif %}>–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                        <option value="asc" {% if filters.sort_order == 'asc' %}selected{% endif %}>–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                    </select>
                </div>
            </div>

            <div class="filter-row">
                <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                <a href="/" class="reset">–°–±—Ä–æ—Å–∏—Ç—å</a>
            </div>
        </form>
    </div>

    {% if posts|length == 0 %}
    <div class="no-posts">
        –ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
    </div>
    {% endif %}

    {% for post in posts %}
    <div class="post">
        <div class="post-title">
            <a href="/post/{{ post._id }}">{{ post.scheme_name }}</a>
        </div>
        <div class="post-meta">
            –ê–≤—Ç–æ—Ä: {{ post.author.name }} {{ post.author.surname }} |
            –î–∞—Ç–∞: {{ post.created_at.strftime('%d.%m.%Y %H:%M') }} |
            –¢–∏–ø: {{ post.type }}
        </div>
        <div class="post-stats">
            <div>‚ù§Ô∏è {{ post.likes|length }} –ª–∞–π–∫–æ–≤</div>
            <div>üé® {{ post.color_count }} —Ü–≤–µ—Ç–æ–≤</div>
            <div>üßµ {{ post.length }} –µ–¥. –Ω–∏—Ç–æ–∫</div>
        </div>
        <p>{{ post.description }}</p>
        {% if post.preview_image_id %}
        <img src="/image/{{ post.preview_image_id }}" alt="{{ post.scheme_name }}" class="post-image" style="max-width: 300px;">
        {% endif %}
    </div>
    {% endfor %}

    <script>
        document.getElementById('filterForm').addEventListener('submit', function(e) {
            const colorCheckboxes = Array.from(this.querySelectorAll('input[name="color_ids"]:checked'));
            const colorIdsInput = document.createElement('input');
            colorIdsInput.type = 'hidden';
            colorIdsInput.name = 'color_ids';
            colorIdsInput.value = colorCheckboxes.map(cb => cb.value).join(',');
            this.appendChild(colorIdsInput);
        });

        // –ê–≤—Ç–æ-–æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        document.querySelectorAll('#filterForm select').forEach(select => {
            select.addEventListener('change', function() {
                document.getElementById('filterForm').submit();
            });
        });
    </script>
</body>
</html>